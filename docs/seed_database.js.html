<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: seed_database.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: seed_database.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/**
 * Seeding module
 * @module Seed Database
 */

const user = require('./models/user');
const event = require('./models/event');
const accessLevel = require('./models/accessLevel');
const club = require('./models/club');
const venue = require('./models/venue');
const permission = require('./models/permission');
const mongoose = require('mongoose');

//method to drop the collection if it exists
const dropIfExists = async (collectionVariable) => {
  try {
    await collectionVariable.collection.drop();
  } catch (err) {
    if (err.message !== 'ns not found') {
      throw err;
    }
  }
};

const userList = [
  {
    name: 'Harish',
    username: 'HarishTeens',
  },
  {
    name: 'Roshan',
    username: 'Rk shaw',
  },
  {
    name: 'Smarak Das',
    username: 'Smarky',
  },
  {
    name: 'CHinmay Kabi',
    username: 'chinukabi',
  },
  {
    name: 'Abel Mathew',
    username: 'Designer Knight',
  },
];
const clubList = ['DSC', 'GDG', 'MCC', 'RED', 'BLUE'];
const eventList = ['Hactoberfest', 'Hackathon', 'RUNIO', 'Fest', 'Enigma'];
const venueList = ['LA-204', 'RM-Hall', 'BBA', 'LA-lawns', 'Library-Lawns'];
const seedData = async () => {
  await dropIfExists(user);
  await dropIfExists(club);
  await dropIfExists(event);
  await dropIfExists(venue);
  await dropIfExists(accessLevel);

  Promise.all(
    userList.map(async (data, index) => {
      let createdUser = await user.create(data);
      const createdClub = await club.create({
        clubName: clubList[index],
      });
      const accessLevelObj = {
        level: '1',
        club: createdClub,
        user: createdUser,
      };
      const createdAccessLevel = await accessLevel.create(accessLevelObj);

      await createdClub.memberAccess.push(createdAccessLevel);
      await createdClub.save();
      await createdUser.clubAccess.push(createdAccessLevel);
      await createdUser.save();
      const createdEvent = await event.create({
        eventName: eventList[index],
      });
      const createdVenue = await venue.create({
        name: venueList[index],
      });
    })
  );
};
// const seedData= async ()=>{}
//     let createdUser=await user.create(userList[0]);
// }

//
/**
 *  A function to seed the database with default permission for the the default role
 */
const seedPermissions = async () => {
  permission.find({ role: 'ROLE101' }, async (err, found) => {
    if (!found.length) {
      await permission.create({
        role: 'ROLE101',
        permissions: ['clubs.all', 'clubs.byId', 'clubs.byName'],
      });
    }
  });
};
module.exports = {
  seedData,
  seedPermissions,
};
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Modules</h3><ul><li><a href="module-Seed%2520Database.html">Seed Database</a></li></ul><h3>Global</h3><ul><li><a href="global.html#context">context</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 3.6.6</a> on Wed Nov 25 2020 22:38:37 GMT+0530 (India Standard Time)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
